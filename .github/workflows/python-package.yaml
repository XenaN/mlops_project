  on:
    push:
      branches:
        - '*'
  jobs:
    build:
      runs-on: ubuntu-18.04
      steps:
        - uses: actions/cache@v2
          id: cache-venv
          with:
            python-version: '3.x'
            path: |
              venv/
              .cache/pip
            key: ${{ runner.os }}-venv-${{ hashFiles('**/requirements*.txt') }}
            restore-keys: |
              ${{ runner.os }}-venv-
        - run: |
            python --version
            python -m venv ./venv
          if: steps.cache-venv.outputs.cache-hit != 'true'
        - run: echo "This job will be run first."

    test_a:
      runs-on: ubuntu-18.04
      needs: [build_a]
      steps:
        - run: echo "This job will run after build_a have finished"

    test_b:
      runs-on: ubuntu-18.04
      needs: [build_a]
      steps:
        - run: echo "This job will run after build_a have finished, it is parallel test_a"

    deploy_ab:
      runs-on: ubuntu-18.04
      needs: [test_a, test_b]
      steps:
        - run: echo "This job will run after test_a and test_ab is complete"