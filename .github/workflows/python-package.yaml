  on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main

  jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - name: Install Python 3.9
          uses: actions/setup-python@v2
          with:
            python-version: 3.9

        - name: Install Poetry
          uses: snok/install-poetry@v1

        - uses: actions/checkout@v3
        - name: Cache dependencies
          id: cached-poetry-dependencies
          uses: actions/cache@v3
          with:
            path: .venv
            key: venv-${{ runner.os }}-${{ steps.setup-python.outputs.python-version }}-${{ hashFiles('**/poetry.lock') }}

        - name: Install dependencies
          if: steps.cached-poetry-dependencies.outputs.cache-hit != 'true'
          run: poetry install --no-interaction --no-root

      - name: Linter
        run: flake8 $(git ls-files '*.py')

      - name: Check Black
        run: black --check $(git ls-files '*.py')
